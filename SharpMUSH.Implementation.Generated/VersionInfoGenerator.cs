using Microsoft.CodeAnalysis;

namespace SharpMUSH.Implementation.Generated;

[Generator]
public class VersionInfoGenerator : IIncrementalGenerator
{
	public void Initialize(IncrementalGeneratorInitializationContext context)
	{
		context.RegisterPostInitializationOutput(ctx => Execute(ctx));
	}

	private static void Execute(IncrementalGeneratorPostInitializationContext context)
	{
		var version = typeof(VersionInfoGenerator).Assembly.GetName().Version?.ToString() ?? "0.0.0.0";

		var code = $$"""
		             // <autogenerated/>
		             namespace SharpMUSH.Implementation.Generated;
		             
		             public static class VersionInfo
		             {
		                 public const string Version = "{{version}}";
		             }
		             """;

		context.AddSource("VersionInfo.g.cs", code);
	}
}
