@using SharpMUSH.Client.Models
@using SharpMUSH.Client.Services
@inject WikiService Wiki


@if (Mode == WikiMode.View)
{
    <WikiDisplay Slug=@Slug Article=@_article ActivateEditMode="ActivateEditMode" />
}
else
{
    <br/>
    <WikiEdit Article=@_article/>
}

@code {
    public enum WikiMode
    {
        View,
        Edit
    }

    [Parameter]
    public required string Slug { get; init; }

    [Parameter]
    public required WikiMode Mode { get; set; } = WikiMode.View;

    public async Task ActivateEditMode()
    {
        await ValueTask.CompletedTask;
        Mode = WikiMode.Edit;
    }

    private WikiArticle? _article;

    protected override async Task OnInitializedAsync()
    {
        var article = await Wiki.GetWikiArticle(Slug);
        
        _article = article.IsT0 ? article.AsT0 : null;

        await base.OnInitializedAsync();
    }
}